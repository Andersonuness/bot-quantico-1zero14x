<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Quântico - 1ZERO14X</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; color: #333; }
        .header { text-align: center; margin-bottom: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        .card { border: 1px solid #ccc; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .active-signal { border-left: 5px solid #007bff; background-color: #e9f0ff; }
        .active-signal h4 { margin-top: 0; color: #007bff; }
        .signal-list { list-style: none; padding: 0; }
        .signal-list li { margin-bottom: 5px; }
        .result-win { color: green; font-weight: bold; }
        .result-loss { color: red; font-weight: bold; }
        .last-result { text-align: center; margin-bottom: 20px; padding: 10px; border: 2px solid #333; border-radius: 5px; }
        .last-result h3 { margin: 0; }
        .last-result span { font-weight: bold; font-size: 1.2em; }

        /* Estilos de cor para o resultado */
        .cor-0 { background-color: white; color: black; border: 1px solid black;} /* Branco */
        .cor-1 { background-color: red; color: white; } /* Vermelho */
        .cor-2 { background-color: black; color: white; } /* Preto */
        
        .stats { display: flex; justify-content: space-around; text-align: center; margin-bottom: 20px; }
        .stats div { padding: 10px; border: 1px solid #ccc; border-radius: 5px; flex-grow: 1; margin: 0 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sinais do Bot Quântico 1ZERO14X</h1>
            <p>Última atualização: <span id="timestamp">--:--:--</span></p>
        </div>

        <div class="last-result">
            <h3>Último Resultado: <span id="last-number" class="cor-0">--</span> (<span id="last-color">--</span>) às <span id="last-time">--:--</span></h3>
        </div>

        <div class="stats">
            <div>Total Sinais: <span id="stats-total">0</span></div>
            <div>WIN: <span id="stats-win" style="color: green;">0</span></div>
            <div>LOSS: <span id="stats-loss" style="color: red;">0</span></div>
            <div>Assertividade: <span id="stats-perc">0%</span></div>
        </div>

        <h2>Sinais Ativos (Branco)</h2>
        <div id="active-signals-container">
            <p id="no-active-signals">Nenhum sinal ativo no momento.</p>
        </div>

        <h2>Histórico Recente</h2>
        <div id="history-signals-container">
            </div>
        
    </div>

    <script>
        // Função para buscar dados da nossa rota /data
        function fetchData() {
            fetch('/data')
                .then(response => {
                    // Trata erro de autenticação, se a sessão expirar
                    if (response.status === 401) {
                        alert("Sessão expirada. Por favor, faça login novamente.");
                        window.location.reload(); // Força o pop-up de login
                        return; 
                    }
                    if (!response.ok) {
                        throw new Error('Erro na rede ou no servidor');
                    }
                    return response.json();
                })
                .then(data => {
                    const now = new Date();
                    document.getElementById('timestamp').textContent = now.toLocaleTimeString('pt-BR');
                    
                    // 1. Atualiza Último Resultado
                    document.getElementById('last-number').textContent = data.ultimo_resultado.numero;
                    document.getElementById('last-color').textContent = data.ultimo_resultado.cor;
                    document.getElementById('last-time').textContent = data.ultimo_resultado.horario;
                    
                    const lastNumberElement = document.getElementById('last-number');
                    lastNumberElement.className = '';
                    if (data.ultimo_resultado.numero === 0) {
                        lastNumberElement.classList.add('cor-0');
                    } else if (data.ultimo_resultado.cor === 'vermelho') {
                        lastNumberElement.classList.add('cor-1');
                    } else if (data.ultimo_resultado.cor === 'preto') {
                        lastNumberElement.classList.add('cor-2');
                    }
                    
                    // 2. Atualiza Estatísticas
                    document.getElementById('stats-total').textContent = data.estatisticas.sinais;
                    document.getElementById('stats-win').textContent = data.estatisticas.win;
                    document.getElementById('stats-loss').textContent = data.estatisticas.loss;
                    document.getElementById('stats-perc').textContent = data.estatisticas.perc;
                    
                    // 3. Atualiza Sinais Ativos
                    const activeContainer = document.getElementById('active-signals-container');
                    activeContainer.innerHTML = '';
                    
                    if (data.sinais_ativos.length === 0) {
                        activeContainer.innerHTML = '<p id="no-active-signals">Nenhum sinal ativo no momento.</p>';
                    } else {
                        data.sinais_ativos.forEach(signal => {
                            const card = document.createElement('div');
                            card.className = 'card active-signal';
                            
                            // Adiciona um estilo de destaque baseado na força
                            if (signal.nivel === 'ALTA') {
                                card.style.borderLeftColor = 'green';
                            } else if (signal.nivel === 'MÉDIA') {
                                card.style.borderLeftColor = 'orange';
                            }
                            
                            card.innerHTML = `
                                <h4>⚪️ Branco em **${signal.horario}**</h4>
                                <p>Força: ${signal.forca}</p>
                                <p>Estratégias: ${signal.estrategias}</p>
                            `;
                            activeContainer.appendChild(card);
                        });
                    }

                    // 4. Atualiza Histórico
                    const historyContainer = document.getElementById('history-signals-container');
                    historyContainer.innerHTML = '';
                    
                    data.historico_sinais.forEach(signal => {
                        const p = document.createElement('p');
                        p.className = signal.resultado === 'WIN' ? 'result-win' : 'result-loss';
                        p.innerHTML = `[${signal.horario}] ${signal.resultado} (${signal.forca}) - ${signal.estrategias}`;
                        historyContainer.appendChild(p);
                    });

                })
                .catch(error => {
                    console.error('Erro ao buscar dados:', error);
                    document.getElementById('timestamp').textContent = 'Erro ao carregar dados.';
                });
        }

        // Chama a função a cada 3 segundos
        setInterval(fetchData, 3000);
        // Chama a função imediatamente ao carregar a página
        fetchData();
    </script>
</body>
</html>